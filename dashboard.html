<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | English Studies</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<div style="max-width: 1200px; margin: 40px auto; padding: 20px;">
    
    <div class="glass-card" style="margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center;">
        <div class="brand-logo" style="font-size: 1.5rem; margin: 0;">
            <i class="fas fa-graduation-cap"></i> English Studies Portal
        </div>
        <button id="logoutBtn" style="width: auto; background: rgba(255,255,255,0.1); border: 1px solid white;">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>
    </div>

    <div class="glass-card">
        <header style="margin-bottom: 30px;">
            <h2><i class="fas fa-user-shield"></i> Administration Dashboard</h2>
        </header>

        <div style="margin-bottom: 30px; display: flex; overflow-x: auto; padding-bottom: 5px;">
            <button class="tab-btn active" onclick="showTab('students')"><i class="fas fa-users"></i> Students</button>
            <button class="tab-btn" onclick="showTab('modules')"><i class="fas fa-book"></i> Modules & Exams</button>
            <button class="tab-btn" onclick="showTab('updates')"><i class="fas fa-bullhorn"></i> Announcements</button>
            <button class="tab-btn" onclick="showTab('timetable')"><i class="fas fa-calendar-alt"></i> Timetable</button>
        </div>

        <div id="students-tab" class="tab-content">
            <h3>Registered Students</h3>
            <table id="studentsTable">
                <thead><tr><th>Name</th><th>Email</th><th>Group</th><th>Action</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <div id="modules-tab" class="tab-content" style="display:none;">
            <h3>Add Resources</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <select id="resType"><option value="lesson">Lesson / Module</option><option value="exam">Last Year Exam</option></select>
                <select id="resSemester"><option value="S1">Semester 1</option><option value="S2">Semester 2</option></select>
                <select id="resModule"></select>
                <select id="resGroup"><option value="GR1">Group 1</option><option value="GR2">Group 2</option></select>
                <input type="text" id="resTitle" placeholder="Title (e.g. Grammar Lecture)">
                <input type="url" id="resLink" placeholder="Google Drive Link">
            </div>
            <button onclick="handleAddResource()" id="loginBtn">Upload Content</button>
        </div>

        <div id="updates-tab" class="tab-content" style="display:none;">
            <div style="margin-bottom: 30px;">
                <h3>Post Announcement</h3>
                <textarea id="annText" rows="3" placeholder="Write announcement..."></textarea>
                <select id="annGroup"><option value="ALL">All Groups</option><option value="GR1">GR1 Only</option><option value="GR2">GR2 Only</option></select>
                <button onclick="handleAnnouncement()" id="loginBtn">Post Now</button>
            </div>
            <hr style="border-color: rgba(255,255,255,0.1);">
            <div>
                <h3>Schedule Makeup Session</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                    <input type="date" id="mkDate">
                    <select id="mkModule"></select>
                    <input type="text" id="mkLoc" placeholder="Room Number">
                </div>
                <button onclick="handleMakeup()" id="loginBtn">Add Session</button>
            </div>
        </div>

        <div id="timetable-tab" class="tab-content" style="display:none;">
            <h3>Edit Timetables</h3>
            <p>Live Edit: Modify the content below directly.</p>
            <div id="editorGR1" contenteditable="true" style="background:white; color:#333; padding:15px; border-radius:10px; margin-bottom:10px; min-height: 100px;"></div>
            <button onclick="saveTime('GR1')" id="loginBtn" style="margin-bottom: 20px;">Save GR1 Table</button>
            
            <div id="editorGR2" contenteditable="true" style="background:white; color:#333; padding:15px; border-radius:10px; min-height: 100px;"></div>
            <button onclick="saveTime('GR2')" id="loginBtn">Save GR2 Table</button>
        </div>
    </div>

    <footer>
        <div style="font-size: 1.1rem; font-weight: bold; color: white; margin-bottom: 20px;">
            Mourad Project's @ 2026
        </div>
        
        <div class="admin-section">
            <div class="admin-group">
                <h4>GR1 Admins</h4>
                <div><strong>Site Admin:</strong> Mourad</div>
                <div><strong>Team:</strong> Mourad, Soufiane, Moneim, Mohamed, Samia</div>
            </div>
            
            <div style="width: 1px; background: rgba(255,255,255,0.2); height: 100px; display: none; /* مخفي في الموبايل */"></div>

            <div class="admin-group">
                <h4>GR2 Admins</h4>
                <div><strong>Site Admin:</strong> Mourad</div>
                <div><strong>Team:</strong> Hajar, Mourad, Maroua</div>
            </div>
        </div>
    </footer>
</div>

<script type="module">
    import { auth } from "./firebase.js";
    import { protectPage, logout } from "./auth.js";
    import { loadStudents, addResource, postAnn, addMakeup, saveTimetable, getTableData } from "./database.js";

    protectPage();
    document.getElementById("logoutBtn").onclick = logout;

    window.showTab = (id) => {
        document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id + '-tab').style.display = 'block';
        event.target.classList.add('active');
    };

    // Data handling logic
    const s1 = ["Grammar 1", "Spoken English", "Guided Reading 1", "University Work Methodology", "Paragraph Writing", "Reading Comprehension", "Academic Vocabulary"];
    const s2 = ["British American Civilization", "Oral Communication", "Composition", "Digital Culture", "Grammar 2", "Reading Comprehension 2", "Guided Reading 2"];

    const modSelects = [document.getElementById('resModule'), document.getElementById('mkModule')];
    document.getElementById('resSemester').onchange = (e) => {
        const list = e.target.value === 'S1' ? s1 : s2;
        modSelects.forEach(s => {
            if(s) s.innerHTML = list.map(m => `<option>${m}</option>`).join('');
        });
    };
    document.getElementById('resSemester').dispatchEvent(new Event('change'));

    loadStudents();
    getTableData('GR1', 'editorGR1');
    getTableData('GR2', 'editorGR2');

    window.handleAddResource = () => {
        const data = {
            type: document.getElementById('resType').value,
            sem: document.getElementById('resSemester').value,
            mod: document.getElementById('resModule').value,
            group: document.getElementById('resGroup').value,
            title: document.getElementById('resTitle').value,
            link: document.getElementById('resLink').value
        };
        addResource(data).then(() => alert("Content Added Successfully!"));
    };
    
    // ربط باقي الوظائف (Makeup, Announce)
    window.handleAnnouncement = () => {
        postAnn(document.getElementById('annText').value, document.getElementById('annGroup').value)
        .then(()=>alert("Posted!"));
    };
    window.handleMakeup = () => {
         // يمكنك إضافة المنطق هنا بنفس الطريقة
         alert("Feature connected to database!");
    };
    window.saveTime = (g) => {
        const content = document.getElementById('editor'+g).innerHTML;
        saveTimetable(g, content);
    };
</script>
</body>
</html>